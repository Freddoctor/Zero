<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>canvas</title>
</head>

<body>

  <!-- <input type="file" id="file"> -->
  <!-- <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script> -->
  <script src="./canvas-to-blob.min.js"></script>
  <script type="text/javascript">
    var img = new Image(),
      canvas = document.createElement('canvas'),
      ctx = canvas.getContext('2d');
    img.setAttribute("crossOrigin", 'Anonymous');
    img.src = './canvas.jpg';
    img.onload = function() {
      ImageData();
    };

    function ImageData() {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      var url = canvas.toDataURL('image/jpeg', 0.6);
      var image = new Image();
      image.src = url;
      document.body.appendChild(image)
    }

    // function blobtoDataURL(blob, callback) {
    //   var fr = new FileReader();
    //   fr.onload = function(e) {
    //     callback(e.target.result);
    //   };
    //   fr.readAsDataURL(blob);
    // }
    //
    // var input = document.getElementById("file");
    // input.addEventListener('change', function(e) {
    //   //获取上传文件
    //   var file = this.files[0];
    //   //转换成img
    //   var img = document.createElement('img');
    //   img.src = window.URL.createObjectURL(file);
    //   //加载图片成功
    //   img.onload = function() {
    //     var canvas = document.createElement("canvas");
    //     var ctx = canvas.getContext("2d");
    //     var width = img.width;
    //     var height = img.height;
    //     canvas.width = width;
    //     canvas.height = height;
    //     //绘制到canvas上
    //     ctx.drawImage(img, 0, 0, width, height);
    //     document.getElementsByTagName('body')[0].appendChild(canvas);
    //     // 利用插件
    //     //利用Blob插件转换，成数据
    //     canvas.toBlob(function(blob) {
    //       //创建forme
    //       var form = new FormData();
    //       form.append('file', blob);
    //       form.append("fileName", "123jpg"); //fileName为自定义，名字随机生成或者写死，看需求
    //       var newImg = document.createElement("img");
    //       var url = URL.createObjectURL(blob);
    //       newImg.onload = function() {
    //         URL.revokeObjectURL(url);
    //       };
    //       newImg.src = url;
    //       document.body.appendChild(newImg);
    //       console.log(form)
    //     }, "image/jpeg", 0.6);
    //   }
    //
    // }, false);
  </script>
</body>

</html>
